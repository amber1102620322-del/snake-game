<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="è´ªåƒè›‡ç½‘é¡µæ¸¸æˆ - æ¸…æ–°å¯çˆ±çš„ä¼‘é—²æ¸¸æˆä½“éªŒ">
    <title>{% block title %}ğŸ è´ªåƒè›‡{% endblock %}</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <a href="/" class="navbar-brand">
            <span class="snake-icon">ğŸ</span>
            <span>è´ªåƒè›‡</span>
        </a>
        <ul class="navbar-nav" id="navLinks">
            <li><a href="/" class="nav-link {% if request.path == '/' %}active{% endif %}">ğŸ  é¦–é¡µ</a></li>
            <li><a href="/game" class="nav-link {% if request.path == '/game' %}active{% endif %}">ğŸ® å¼€å§‹æ¸¸æˆ</a></li>
            <li><a href="/records" class="nav-link {% if request.path == '/records' %}active{% endif %}">ğŸ“Š æ•°æ®ä¸­å¿ƒ</a></li>
        </ul>
        <div id="navUser">
            <!-- ç”± JS åŠ¨æ€å¡«å…… -->
        </div>
    </nav>

    <!-- æ¶ˆæ¯æç¤º -->
    <div class="toast" id="toast"></div>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    <!-- åŸºç¡€è„šæœ¬ -->
    <script>
        // å…¨å±€å·¥å…·å‡½æ•°

        // æ˜¾ç¤ºæ¶ˆæ¯æç¤º
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast toast-' + type + ' show';
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // æ£€æŸ¥ç™»å½•çŠ¶æ€å¹¶æ›´æ–°å¯¼èˆªæ 
        async function checkAuth() {
            try {
                const res = await fetch('/api/me');
                const data = await res.json();
                const navUser = document.getElementById('navUser');

                if (data.logged_in) {
                    const initial = data.username.charAt(0).toUpperCase();
                    navUser.innerHTML = `
                        <div class="nav-user">
                            <div class="avatar">${initial}</div>
                            <span>${data.username}</span>
                        </div>
                        <button class="btn-logout" onclick="logout()">ç™»å‡º</button>
                    `;
                    return data;
                } else {
                    navUser.innerHTML = `
                        <a href="/login" class="btn btn-primary" style="padding:8px 20px; font-size:0.9rem;">ç™»å½•</a>
                    `;
                    return null;
                }
            } catch (e) {
                console.error('æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥', e);
                return null;
            }
        }

        // ç™»å‡º
        async function logout() {
            await fetch('/api/logout', { method: 'POST' });
            showToast('å·²æˆåŠŸç™»å‡º');
            setTimeout(() => { window.location.href = '/'; }, 800);
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
        document.addEventListener('DOMContentLoaded', checkAuth);
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>
